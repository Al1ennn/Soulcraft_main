<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Вхід - Soulcraft</title>
    <link rel="stylesheet" href="style.css">
    <!-- Додаємо шрифти -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@300;400&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <nav>
            <a href="index.html" class="logo-nav">SoulCraft</a>
            <div class="nav-links">
            </div>
        </nav>
    </header>

    <main class="form-container">
        <h1>Вхід в акаунт</h1>
        
        <form id="login-form">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" placeholder="example@gmail.com" required>
            
            <label for="password">Пароль</label>
            <input type="password" id="password" name="password" placeholder="Ваш пароль" required>
            
            <button type="submit" class="button button-primary">Увійти</button>
        </form>
        
        <p>Немає акаунту? <a href="register.html">Створити</a></p>
        
        <!-- 
            --- НОВИЙ БЛОК ДЛЯ ПОВТОРНОЇ ВІДПРАВКИ ---
        -->
        <p style="margin-top: 20px; border-top: 1px solid #3a3a3a; padding-top: 20px; text-align: center;">
            Не прийшов лист? 
            <a href="#" id="resend-verification-link">Надіслати повторно</a>
        </p>
        
    </main>

    <!-- ======== ПОЧАТОК БЛОКУ FIREBASE ======== -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>

    <script>
        // ВАШІ КЛЮЧІ
        const firebaseConfig = {
          apiKey: "AIzaSyDI1y9z3JqGwjOYacWsHZgPhU038YBz9pA",
          authDomain: "soulcraft-project.firebaseapp.com",
          projectId: "soulcraft-project",
          storageBucket: "soulcraft-project.firebasestorage.app",
          messagingSenderId: "442181022403",
          appId: "1:442181022403:web:590c4523ebcc12213c2876"
        };

        // Ініціалізуємо Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        const loginForm = document.getElementById('login-form');
        const resendLink = document.getElementById('resend-verification-link');

        // ЛОГІКА ВХОДУ
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = loginForm.email.value;
            const password = loginForm.password.value;

            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    
                    // --- ОНОВЛЕНА ПЕРЕВІРКА ---
                    if (userCredential.user.emailVerified) {
                        // Пошта підтверджена, пускаємо в кабінет
                        alert("Успішний вхід! Вітаємо.");
                        window.location.href = "dashboard.html";
                    } else {
                        // Пошта НЕ підтверджена
                        alert("Ваша пошта ще не підтверджена. Будь ласка, перевірте лист у вашій поштовій скринці.");
                        // Виходимо з системи, щоб не тримати його залогіненим
                        auth.signOut();
                    }

                })
                .catch((error) => {
                    alert("Помилка: " + error.message);
                });
        });

        // 
        // --- НОВА ФУНКЦІЯ: ПОВТОРНА ВІДПРАВКА ЛИСТА ---
        // 
        resendLink.addEventListener('click', (e) => {
            e.preventDefault();
            
            // Беремо пошту, яку користувач вже ввів у поле "Email"
            const email = loginForm.email.value;
            
            if (!email) {
                alert("Будь ласка, спочатку введіть вашу пошту у поле 'Email' вище.");
                return;
            }

            // Намагаємось відправити лист (це спрацює, тільки якщо користувач
            // вже залогінений, тому ми просимо його спочатку увійти)
            const user = auth.currentUser;
            
            if (user) {
                 // Якщо він вже залогінений (але не верифікований), відправляємо
                 user.sendEmailVerification()
                    .then(() => {
                        alert("Новий лист з підтвердженням відправлено на вашу пошту! Будь ласка, перевірте її.");
                    })
                    .catch((error) => {
                        alert("Помилка: " + error.message);
                    });
            } else {
                alert("Помилка: Щоб відправити лист повторно, Firebase вимагає, щоб ви спочатку спробували увійти в систему. Будь ласка, введіть логін/пароль та натисніть 'Увійти'.");
            }
        });
    </script>
    <!-- ======== КІНЕЦЬ БЛОКУ FIREBASE ======== -->
</body>
</html>
