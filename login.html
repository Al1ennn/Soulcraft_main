<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Вхід - Soulcraft</title>
    <link rel="stylesheet" href="style.css">
    <!-- Додаємо шрифти -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@300;400&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <nav>
           <a href="index.html" class="button">На головну</a>
            <div class="nav-links">
            </div>
        </nav>
    </header>

    <main class="form-container">
        <h1>Вхід в акаунт</h1>
        
        <form id="login-form">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" placeholder="example@gmail.com" required>
            
            <label for="password">Пароль</label>
            <input type="password" id="password" name="password" placeholder="Ваш пароль" required>
            
            <button type="submit" class="button button-primary">Увійти</button>
        </form>
        
        <p>Немає акаунту? <a href="register.html">Створити</a></p>
        
        <p style="margin-top: 20px; border-top: 1px solid #3a3a3a; padding-top: 20px; text-align: center;">
            Не прийшов лист? 
            <a href="#" id="resend-verification-link">Надіслати повторно</a>
        </p>
        
    </main>

    <!-- ======== ПОЧАТОК БЛОКУ FIREBASE ======== -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>

    <script>
        // ВАШІ КЛЮЧІ
        const firebaseConfig = {
          apiKey: "AIzaSyDI1y9z3JqGwjOYacWsHZgPhU038YBz9pA",
          authDomain: "soulcraft-project.firebaseapp.com",
          projectId: "soulcraft-project",
          storageBucket: "soulcraft-project.firebasestorage.app",
          messagingSenderId: "442181022403",
          appId: "1:442181022403:web:590c4523ebcc12213c2876"
        };

        // Ініціалізуємо Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        const loginForm = document.getElementById('login-form');
        const resendLink = document.getElementById('resend-verification-link');

        // ЛОГІКА ВХОДУ
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = loginForm.email.value;
            const password = loginForm.password.value;

            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    
                    if (userCredential.user.emailVerified) {
                        // Пошта підтверджена
                        alert("Успішний вхід! Вітаємо.");
                        window.location.href = "dashboard.html";
                    } else {
                        // Пошта НЕ підтверджена
                        alert("Ваша пошта ще не підтверджена. Будь ласка, перевірте лист у скринці або натисніть 'Надіслати повторно' нижче.");
                    }

                })
                .catch((error) => {
                    alert("Помилка: " + error.message);
                });
        });

        // ЛОГІКА ПОВТОРНОЇ ВІДПРАВКИ
        resendLink.addEventListener('click', (e) => {
            e.preventDefault();
            
            const user = auth.currentUser;
            
            if (user) {
                 // --- ВИПРАВЛЕНО: actionCodeSettings для правильного повернення ---
                 const actionCodeSettings = {
                    url: 'https://al1ennn.github.io/Soulcraft_main/login.html'
                 };

                 user.sendEmailVerification(actionCodeSettings)
                    .then(() => {
                        alert("Новий лист з підтвердженням відправлено на вашу пошту! Будь ласка, перевірте її (та папку Спам).");
                    })
                    .catch((error) => {
                        alert("Помилка: " + error.message);
                    });
            } else {
                alert("Будь ласка, спочатку спробуйте увійти, а потім натисніть це посилання ще раз.");
            }
        });
    </script>
    <!-- ======== КІНЕЦЬ БЛОКУ FIREBASE ======== -->
</body>
</html>
