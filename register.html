<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Реєстрація - Soulcraft</title>
    <link rel="stylesheet" href="style.css">
    <!-- Додаємо шрифти -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@300;400&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <nav>
            <a href="index.html" class="button">На головну</a>
            <div class="nav-links">
                <a href="shop.html" class="button">Магазин</a>
            </div>
        </nav>
    </header>

    <main class="form-container">
        <h1>Створити акаунт</h1>
        
        <form id="register-form">
            <label for="email">Ваш Email</label>
            <input type="email" id="email" name="email" placeholder="example@gmail.com" required>
            
            <label for="password">Пароль</label>
            <input type="password" id="password" name="password" placeholder="Ваш пароль" required>
            
            <!-- 
              --- НОВИЙ БЛОК: ВИБІР РОЛІ ---
            -->
            <label>Я реєструюсь як:</label>
            <div class="role-selector">
                <input type="radio" id="role-buyer" name="role" value="buyer" checked required>
                <label for="role-buyer">Покупець</label>
                
                <input type="radio" id="role-seller" name="role" value="seller">
                <label for="role-seller">Продавець</label>
            </div>
            <!-- --- КІНЕЦЬ НОВОГО БЛОКУ --- -->
            
            <button type="submit" class="button button-primary">Зареєструватись</button>
        </form>
        
        <p>Вже маєте акаунт? <a href="login.html">Увійти</a></p>
    </main>

    <!-- ======== БЛОК FIREBASE ======== -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <!-- Додаємо Firestore, він потрібен для збереження ролі -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

    <script>
        // ВАШІ КЛЮЧІ
        const firebaseConfig = {
          apiKey: "AIzaSyDI1y9z3JqGwjOYacWsHZgPhU038YBz9pA",
          authDomain: "soulcraft-project.firebaseapp.com",
          projectId: "soulcraft-project",
          storageBucket: "soulcraft-project.firebasestorage.app",
          messagingSenderId: "442181022403",
          appId: "1:442181022403:web:590c4523ebcc12213c2876"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore(); // Ініціалізуємо Firestore
        const registerForm = document.getElementById('register-form');

        registerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = registerForm.email.value;
            const password = registerForm.password.value;
            
            // --- НОВЕ: Отримуємо обрану роль ---
            const role = registerForm.role.value; 

            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    console.log("Користувач створений, ID:", user.uid);

                    // --- ОНОВЛЕНО: Створюємо документ у Firestore ОДРАЗУ ---
                    // Ми зберігаємо роль та створюємо порожній профіль
                    const userDocRef = db.collection('users').doc(user.uid);
                    
                    userDocRef.set({
                        role: role, // Зберігаємо роль!
                        name: "",   // Порожні поля, які користувач заповнить пізніше
                        city: "",
                        phone: "",
                        photoURL: ""
                    })
                    .then(() => {
                        console.log("Документ користувача створено з роллю:", role);
                        
                        // Тепер відправляємо лист (з правильним URL)
                        const actionCodeSettings = {
                            url: 'https://al1ennn.github.io/Soulcraft_main/login.html'
                        };
                        
                        user.sendEmailVerification(actionCodeSettings)
                            .then(() => {
                                alert("Реєстрація успішна! Ми відправили вам на пошту лист для підтвердження акаунту.");
                                window.location.href = "login.html";
                            })
                            .catch((emailError) => {
                                console.error("Помилка відправки листа:", emailError);
                                alert("Помилка відправки листа: " + emailError.message);
                            });
                    })
                    .catch((dbError) => {
                         console.error("Помилка створення документа в Firestore:", dbError);
                         alert("Помилка створення профілю: " + dbError.message);
                    });
                })
                .catch((error) => {
                    console.error("Помилка реєстрації:", error);
                    alert("Помилка реєстрації: " + error.message);
                });
        });
    </script>
</body>
</html>
